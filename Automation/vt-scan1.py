import requests
import sys
import json
import time
import os, fnmatch
import hashlib

filepath = 'sha256.txt'
suffix = "_obfuscated.apk"
listOfFiles = os.listdir('.')
pattern = "*.apk"
file1 = open("scan_report.txt","w")
timeout = 0
# For uploading files to VirusTotal to be scanned
for entry in listOfFiles:
   if fnmatch.fnmatch(entry, pattern):    
            #     print("Going to sleep")
            #     timeout = 0
            #     time.sleep(60)
            print("Counter = ", timeout)
            print ("Filename :", entry)
            with open(entry,"rb") as f:
               bytes = f.read() # read entire file as bytes
               hash_sha = hashlib.sha256(bytes).hexdigest();
               print("computed hash :", hash_sha)
            #cmd = 'sha256sum ' + entry + ' | awk \'{print $1}\''
            #hash_sha = os.popen(cmd).read()
            #hash_sha = hash_sha.rstrip('\n')
            #print ("computed hash :", hash_sha)
            #hash1 = format(line.strip())
            #print(hash1)
            #hash_md5 = str(sys.argv[1])
            #print(hash_md5)
            url = 'https://www.virustotal.com/vtapi/v2/file/scan'
            params = {'apikey': '<your VirusTotal api key here>'}
            files = {'file': (entry, open(entry, 'rb'))}
            response = requests.post(url, files=files, params=params)
            print(response.status_code)
            #print(params)
            timeout += 1
            #cnt += 1
file1.write("Submission Completed for = " + str(timeout))
file1.close()


